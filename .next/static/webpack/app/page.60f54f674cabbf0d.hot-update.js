"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/page",{

/***/ "(app-pages-browser)/./components/apartment-3d-viewer.tsx":
/*!********************************************!*\
  !*** ./components/apartment-3d-viewer.tsx ***!
  \********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Apartment3DViewer: () => (/* binding */ Apartment3DViewer)\n/* harmony export */ });\n/* harmony import */ var react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-dev-runtime */ \"(app-pages-browser)/./node_modules/next/dist/compiled/react/jsx-dev-runtime.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(app-pages-browser)/./node_modules/next/dist/compiled/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* __next_internal_client_entry_do_not_use__ Apartment3DViewer auto */ \nvar _s = $RefreshSig$();\n\nfunction Apartment3DViewer(param) {\n    let { apartment, onClose } = param;\n    _s();\n    const iframeRef = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null);\n    const [isLoading, setIsLoading] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(true);\n    const [error, setError] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\n    const [iframeKey, setIframeKey] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(0) // 添加key来强制重新创建iframe\n    ;\n    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)({\n        \"Apartment3DViewer.useEffect\": ()=>{\n            if (!apartment.hasModel) {\n                setError(\"该公寓暂无3D模型\");\n                setIsLoading(false);\n                return;\n            }\n            // 重置状态\n            setError(null);\n            setIsLoading(true);\n            // 延迟一点时间确保iframe完全重新创建\n            const timer = setTimeout({\n                \"Apartment3DViewer.useEffect.timer\": ()=>{\n                    // 创建3D查看器的HTML内容\n                    const create3DViewerHTML = {\n                        \"Apartment3DViewer.useEffect.timer.create3DViewerHTML\": ()=>{\n                            return '\\n<!DOCTYPE html>\\n<html lang=\"zh-CN\">\\n<head>\\n    <meta charset=\"UTF-8\">\\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\\n    <title>'.concat(apartment.title, ' - 3D查看器</title>\\n    <style>\\n        body {\\n            margin: 0;\\n            padding: 0;\\n            font-family: -apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, sans-serif;\\n            background: #f5f5f5;\\n            overflow: hidden;\\n        }\\n        \\n        .viewer-container {\\n            display: flex;\\n            height: 100vh;\\n            width: 100vw;\\n        }\\n        \\n        .sidebar {\\n            width: 280px;\\n            background: white;\\n            border-right: 1px solid #e5e5e5;\\n            padding: 20px;\\n            overflow-y: auto;\\n            box-shadow: 2px 0 10px rgba(0,0,0,0.1);\\n        }\\n        \\n        .model-view {\\n            flex: 1;\\n            position: relative;\\n            background: #f0f0f0;\\n        }\\n        \\n        #modelContainer {\\n            width: 100%;\\n            height: 100%;\\n            position: relative;\\n        }\\n        \\n        .panel {\\n            background: #f8f9fa;\\n            border: 1px solid #e9ecef;\\n            border-radius: 8px;\\n            padding: 16px;\\n            margin-bottom: 16px;\\n        }\\n        \\n        .panel h3 {\\n            margin: 0 0 12px 0;\\n            font-size: 14px;\\n            font-weight: 600;\\n            color: #333;\\n            display: flex;\\n            align-items: center;\\n            gap: 8px;\\n        }\\n        \\n        .btn {\\n            background: #007bff;\\n            color: white;\\n            border: none;\\n            padding: 8px 16px;\\n            border-radius: 6px;\\n            cursor: pointer;\\n            font-size: 13px;\\n            margin: 4px;\\n            transition: background-color 0.2s;\\n        }\\n        \\n        .btn:hover {\\n            background: #0056b3;\\n        }\\n        \\n        .btn.secondary {\\n            background: #6c757d;\\n        }\\n        \\n        .btn.secondary:hover {\\n            background: #545b62;\\n        }\\n        \\n        .btn.full-width {\\n            width: 100%;\\n            margin: 4px 0;\\n        }\\n        \\n        .controls-group {\\n            display: flex;\\n            flex-wrap: wrap;\\n            gap: 4px;\\n            margin-top: 8px;\\n        }\\n        \\n        .controls-group .btn {\\n            flex: 1;\\n            min-width: 80px;\\n        }\\n        \\n        select {\\n            width: 100%;\\n            padding: 8px;\\n            border: 1px solid #ddd;\\n            border-radius: 4px;\\n            font-size: 13px;\\n            margin-top: 8px;\\n        }\\n        \\n        .view-info {\\n            position: absolute;\\n            top: 20px;\\n            right: 20px;\\n            background: rgba(0,0,0,0.7);\\n            color: white;\\n            padding: 8px 12px;\\n            border-radius: 6px;\\n            font-size: 12px;\\n            z-index: 100;\\n        }\\n        \\n        .esc-prompt {\\n            position: absolute;\\n            top: 20px;\\n            left: 20px;\\n            background: rgba(255,0,0,0.8);\\n            color: white;\\n            padding: 8px 12px;\\n            border-radius: 6px;\\n            font-size: 12px;\\n            z-index: 100;\\n        }\\n        \\n        .esc-prompt.hidden {\\n            display: none;\\n        }\\n        \\n        #loadingOverlay {\\n            position: absolute;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n            background: rgba(255,255,255,0.9);\\n            display: flex;\\n            flex-direction: column;\\n            justify-content: center;\\n            align-items: center;\\n            z-index: 1000;\\n        }\\n        \\n        .spinner {\\n            width: 40px;\\n            height: 40px;\\n            border: 4px solid #f3f3f3;\\n            border-top: 4px solid #007bff;\\n            border-radius: 50%;\\n            animation: spin 1s linear infinite;\\n        }\\n        \\n        @keyframes spin {\\n            0% { transform: rotate(0deg); }\\n            100% { transform: rotate(360deg); }\\n        }\\n        \\n        .loading-text {\\n            margin-top: 16px;\\n            font-size: 14px;\\n            color: #666;\\n        }\\n        \\n        .center-screen {\\n            position: absolute;\\n            top: 50%;\\n            left: 50%;\\n            transform: translate(-50%, -50%);\\n            z-index: 200;\\n        }\\n        \\n        .center-screen.hidden {\\n            display: none;\\n        }\\n        \\n        .prompt-content {\\n            background: white;\\n            padding: 20px;\\n            border-radius: 8px;\\n            box-shadow: 0 4px 20px rgba(0,0,0,0.3);\\n        }\\n        \\n        .close-btn {\\n            position: absolute;\\n            top: 10px;\\n            right: 10px;\\n            background: rgba(0,0,0,0.5);\\n            color: white;\\n            border: none;\\n            width: 30px;\\n            height: 30px;\\n            border-radius: 50%;\\n            cursor: pointer;\\n            font-size: 16px;\\n            z-index: 1001;\\n        }\\n        \\n        .close-btn:hover {\\n            background: rgba(0,0,0,0.7);\\n        }\\n    </style>\\n</head>\\n<body>\\n    <div class=\"viewer-container\">\\n        <div class=\"sidebar\">\\n            <div class=\"panel\">\\n                <h3>\\uD83C\\uDFE0 公寓信息</h3>\\n                <h4 style=\"margin: 0; color: #333;\">').concat(apartment.title, '</h4>\\n                <p style=\"font-size: 12px; color: #666; margin: 8px 0 0 0;\">').concat(apartment.description, '</p>\\n            </div>\\n\\n            <div class=\"panel\">\\n                <h3>\\uD83C\\uDFAE 视角控制</h3>\\n                <div class=\"controls-group\">\\n                    <button id=\"toggleControlModeBtn\" class=\"btn full-width\">\\n                        <span id=\"controlModeText\">切换到FPS模式</span>\\n                    </button>\\n                </div>\\n                <div class=\"controls-group\">\\n                    <button id=\"viewTopBtn\" class=\"btn secondary\">顶视图</button>\\n                    <button id=\"viewFrontBtn\" class=\"btn secondary\">正视图</button>\\n                    <button id=\"viewSideBtn\" class=\"btn secondary\">侧视图</button>\\n                </div>\\n                <div class=\"controls-group\">\\n                    <button id=\"resetViewBtn\" class=\"btn full-width\">重置视图</button>\\n                </div>\\n                <div class=\"controls-group\">\\n                    <button id=\"toggleWireframeBtn\" class=\"btn secondary full-width\">切换线框模式</button>\\n                </div>\\n            </div>\\n\\n            <div class=\"panel\">\\n                <h3>⚙️ 质量控制</h3>\\n                <label for=\"qualitySelector\">渲染质量:</label>\\n                <select id=\"qualitySelector\">\\n                    <option value=\"low\">低 (更流畅)</option>\\n                    <option value=\"medium\" selected>中 (平衡)</option>\\n                    <option value=\"high\">高 (更清晰)</option>\\n                </select>\\n            </div>\\n\\n            <div class=\"panel\">\\n                <h3>\\uD83D\\uDCF7 截图</h3>\\n                <button id=\"screenshotBtn\" class=\"btn full-width\">保存截图</button>\\n            </div>\\n        </div>\\n\\n        <div class=\"model-view\">\\n            <button class=\"close-btn\" onclick=\"window.parent.postMessage(\\'close\\', \\'*\\')\" title=\"关闭\">\\xd7</button>\\n            <div id=\"modelContainer\">\\n                <div class=\"view-info\">\\n                    <div id=\"rotationInfo\">视角: 0\\xb0</div>\\n                    <div id=\"zoomInfo\">高度: ').concat(apartment.config.camera.height, 'm</div>\\n                </div>\\n                <div id=\"escExitPrompt\" class=\"esc-prompt hidden\">\\n                    按ESC退出FPS模式\\n                </div>\\n                <div id=\"loadingOverlay\">\\n                    <div class=\"spinner\"></div>\\n                    <div class=\"loading-text\">正在加载模型...</div>\\n                </div>\\n                <div id=\"pointerLockPrompt\" class=\"center-screen hidden\">\\n                    <div class=\"prompt-content\">\\n                        <button id=\"enterFPSBtn\" class=\"btn full-width\" style=\"font-size:1.1rem;padding:1em 2em;\">点击以启用FPS控制</button>\\n                    </div>\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n\\n    <!-- Three.js 库 -->\\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js\"></script>\\n    <script src=\"https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js\"></script>\\n    <script src=\"https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.min.js\"></script>\\n    <script src=\"https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.min.js\"></script>\\n    <script src=\"https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.min.js\"></script>\\n    \\n    <script>\\n        // 强制重置所有全局变量\\n        if (window.scene) {\\n            window.scene.clear();\\n        }\\n        if (window.renderer) {\\n            window.renderer.dispose();\\n        }\\n        \\n        // 3D查看器初始化脚本\\n        let scene, camera, renderer, controls, model;\\n        let orbitControls, pointerLockControls;\\n        let isWireframe = false;\\n        let currentControlMode = \\'orbit\\'; // \\'orbit\\' or \\'fps\\'\\n        let animationId = null; // 用于清理动画循环\\n        let keyboardControls = null; // 键盘控制器\\n        \\n        // 公寓配置\\n        const apartmentConfig = ').concat(JSON.stringify(apartment.config), ';\\n        const modelPath = \"').concat(apartment.modelPath, \"\\\";\\n        \\n        // 键盘控制类 - 完整的WASD移动逻辑\\n        class KeyboardControls {\\n            constructor(camera, scene, domElement) {\\n                this.camera = camera;\\n                this.scene = scene;\\n                this.domElement = domElement;\\n                \\n                // 控制状态\\n                this.enabled = false;\\n                this.isMoving = false;\\n                \\n                // 移动参数\\n                this.movementSpeed = 0.05;\\n                this.fixedHeight = this.camera.position.y;\\n                \\n                // 按键状态\\n                this.keys = {\\n                    87: false, // W\\n                    83: false, // S\\n                    65: false, // A\\n                    68: false, // D\\n                    38: false, // 上箭头\\n                    40: false, // 下箭头\\n                    37: false, // 左箭头\\n                    39: false  // 右箭头\\n                };\\n                \\n                // 绑定事件处理函数\\n                this._onKeyDown = this._onKeyDown.bind(this);\\n                this._onKeyUp = this._onKeyUp.bind(this);\\n            }\\n            \\n            enable() {\\n                if (this.enabled) return;\\n                \\n                this.enabled = true;\\n                document.addEventListener('keydown', this._onKeyDown, false);\\n                document.addEventListener('keyup', this._onKeyUp, false);\\n                console.log('键盘控制已启用');\\n            }\\n            \\n            disable() {\\n                if (!this.enabled) return;\\n                \\n                this.enabled = false;\\n                document.removeEventListener('keydown', this._onKeyDown, false);\\n                document.removeEventListener('keyup', this._onKeyUp, false);\\n                \\n                // 重置按键状态\\n                for (let key in this.keys) {\\n                    this.keys[key] = false;\\n                }\\n                this.isMoving = false;\\n                console.log('键盘控制已禁用');\\n            }\\n            \\n            _onKeyDown(event) {\\n                if (!this.enabled) return;\\n                \\n                const keyCode = event.keyCode;\\n                \\n                // 检查移动键\\n                if (event.key === 'w' || event.key === 'W' || keyCode === 87 || keyCode === 38) {\\n                    this.keys[87] = true;\\n                } else if (event.key === 's' || event.key === 'S' || keyCode === 83 || keyCode === 40) {\\n                    this.keys[83] = true;\\n                } else if (event.key === 'a' || event.key === 'A' || keyCode === 65 || keyCode === 37) {\\n                    this.keys[65] = true;\\n                } else if (event.key === 'd' || event.key === 'D' || keyCode === 68 || keyCode === 39) {\\n                    this.keys[68] = true;\\n                }\\n                \\n                // 阻止默认行为\\n                if ([32, 37, 38, 39, 40, 87, 83, 65, 68].includes(keyCode)) {\\n                    event.preventDefault();\\n                }\\n            }\\n            \\n            _onKeyUp(event) {\\n                if (!this.enabled) return;\\n                \\n                const keyCode = event.keyCode;\\n                \\n                // 检查移动键\\n                if (event.key === 'w' || event.key === 'W' || keyCode === 87 || keyCode === 38) {\\n                    this.keys[87] = false;\\n                } else if (event.key === 's' || event.key === 'S' || keyCode === 83 || keyCode === 40) {\\n                    this.keys[83] = false;\\n                } else if (event.key === 'a' || event.key === 'A' || keyCode === 65 || keyCode === 37) {\\n                    this.keys[65] = false;\\n                } else if (event.key === 'd' || event.key === 'D' || keyCode === 68 || keyCode === 39) {\\n                    this.keys[68] = false;\\n                }\\n            }\\n            \\n            update() {\\n                if (!this.enabled) return;\\n                \\n                try {\\n                    // 检查按键状态\\n                    const movingForward = this.keys[87]; // W\\n                    const movingBackward = this.keys[83]; // S\\n                    const movingLeft = this.keys[65]; // A\\n                    const movingRight = this.keys[68]; // D\\n                    \\n                    // 如果没有按键按下，直接返回\\n                    if (!(movingForward || movingBackward || movingLeft || movingRight)) {\\n                        if (this.isMoving) {\\n                            this.isMoving = false;\\n                        }\\n                        return;\\n                    }\\n                    \\n                    // 获取相机的朝向\\n                    const direction = new THREE.Vector3();\\n                    this.camera.getWorldDirection(direction);\\n                    direction.normalize();\\n                    \\n                    // 获取右向量\\n                    const right = new THREE.Vector3();\\n                    right.crossVectors(direction, new THREE.Vector3(0, 1, 0)).normalize();\\n                    \\n                    // 计算移动向量\\n                    const moveVector = new THREE.Vector3(0, 0, 0);\\n                    \\n                    if (movingForward) {\\n                        moveVector.add(direction);\\n                    }\\n                    if (movingBackward) {\\n                        moveVector.sub(direction);\\n                    }\\n                    if (movingRight) {\\n                        moveVector.add(right);\\n                    }\\n                    if (movingLeft) {\\n                        moveVector.sub(right);\\n                    }\\n                    \\n                    // 归一化移动向量\\n                    moveVector.normalize();\\n                    moveVector.multiplyScalar(this.movementSpeed);\\n                    \\n                    // 只在xz平面移动\\n                    moveVector.y = 0;\\n                    \\n                    // 更新相机位置\\n                    this.camera.position.add(moveVector);\\n                    this.camera.position.y = this.fixedHeight;\\n                    \\n                    if (!this.isMoving) {\\n                        this.isMoving = true;\\n                    }\\n                } catch (error) {\\n                    console.error('键盘控制更新时出错:', error);\\n                }\\n            }\\n            \\n            setFixedHeight(height) {\\n                this.fixedHeight = height;\\n            }\\n            \\n            setMovementSpeed(speed) {\\n                this.movementSpeed = speed;\\n            }\\n        }\\n        \\n        // 清理之前的资源\\n        function cleanup() {\\n            if (animationId) {\\n                cancelAnimationFrame(animationId);\\n                animationId = null;\\n            }\\n            \\n            if (keyboardControls) {\\n                keyboardControls.disable();\\n                keyboardControls = null;\\n            }\\n            \\n            if (renderer) {\\n                renderer.dispose();\\n                renderer.forceContextLoss();\\n                if (renderer.domElement && renderer.domElement.parentNode) {\\n                    renderer.domElement.parentNode.removeChild(renderer.domElement);\\n                }\\n            }\\n            \\n            if (scene) {\\n                scene.clear();\\n            }\\n            \\n            // 清理事件监听器\\n            window.removeEventListener('resize', onWindowResize);\\n            document.removeEventListener('keydown', onKeyDown);\\n        }\\n        \\n        // 初始化3D场景\\n        function init() {\\n            try {\\n                // 先清理之前的资源\\n                cleanup();\\n                \\n                // 创建场景\\n                scene = new THREE.Scene();\\n                scene.background = new THREE.Color(0xf0f0f0);\\n                \\n                // 创建相机\\n                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);\\n                camera.position.set(apartmentConfig.camera.init_point[0], apartmentConfig.camera.height, apartmentConfig.camera.init_point[1]);\\n                \\n                // 创建渲染器\\n                renderer = new THREE.WebGLRenderer({ antialias: true });\\n                renderer.setSize(window.innerWidth - 280, window.innerHeight);\\n                renderer.shadowMap.enabled = true;\\n                renderer.shadowMap.type = THREE.PCFSoftShadowMap;\\n                \\n                const container = document.getElementById('modelContainer');\\n                const canvas = container.querySelector('canvas');\\n                if (canvas) {\\n                    container.removeChild(canvas);\\n                }\\n                container.appendChild(renderer.domElement);\\n                \\n                // 创建控制器\\n                setupControls();\\n                \\n                // 添加光源\\n                setupLighting();\\n                \\n                // 加载模型\\n                loadModel();\\n                \\n                // 设置事件监听\\n                setupEventListeners();\\n                \\n                // 开始渲染循环\\n                animate();\\n                \\n            } catch (error) {\\n                console.error('初始化3D场景失败:', error);\\n                const loadingOverlay = document.getElementById('loadingOverlay');\\n                if (loadingOverlay) {\\n                    loadingOverlay.innerHTML = '<div style=\\\"color: red;\\\">3D场景初始化失败</div>';\\n                }\\n            }\\n        }\\n        \\n        function setupControls() {\\n            // 轨道控制器\\n            orbitControls = new THREE.OrbitControls(camera, renderer.domElement);\\n            orbitControls.enableDamping = true;\\n            orbitControls.dampingFactor = 0.05;\\n            orbitControls.target.set(0, 0, 0);\\n            \\n            // FPS控制器\\n            pointerLockControls = new THREE.PointerLockControls(camera, renderer.domElement);\\n            scene.add(pointerLockControls.getObject());\\n            \\n            // 键盘控制器\\n            keyboardControls = new KeyboardControls(camera, scene, renderer.domElement);\\n            keyboardControls.setFixedHeight(apartmentConfig.camera.height);\\n            \\n            // 默认使用轨道控制器\\n            orbitControls.enabled = true;\\n            pointerLockControls.enabled = false;\\n            keyboardControls.disable();\\n        }\\n        \\n        function setupLighting() {\\n            // 环境光\\n            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);\\n            scene.add(ambientLight);\\n            \\n            // 方向光\\n            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);\\n            directionalLight.position.set(10, 10, 5);\\n            directionalLight.castShadow = true;\\n            scene.add(directionalLight);\\n            \\n            // 点光源\\n            const pointLight = new THREE.PointLight(0xffffff, 0.5);\\n            pointLight.position.set(0, 5, 0);\\n            scene.add(pointLight);\\n        }\\n        \\n        function loadModel() {\\n            const loadingOverlay = document.getElementById('loadingOverlay');\\n            \\n            // MTL加载器\\n            const mtlLoader = new THREE.MTLLoader();\\n            mtlLoader.setPath(modelPath + '/');\\n            \\n            mtlLoader.load('textured_output.mtl', function(materials) {\\n                materials.preload();\\n                \\n                // OBJ加载器\\n                const objLoader = new THREE.OBJLoader();\\n                objLoader.setMaterials(materials);\\n                objLoader.setPath(modelPath + '/');\\n                \\n                objLoader.load('textured_output.obj', \\n                    function(object) {\\n                        // 模型加载成功\\n                        model = object;\\n                        scene.add(model);\\n                        \\n                        // 计算模型边界盒\\n                        const box = new THREE.Box3().setFromObject(model);\\n                        const center = box.getCenter(new THREE.Vector3());\\n                        const size = box.getSize(new THREE.Vector3());\\n                        \\n                        // 调整相机位置\\n                        const maxDim = Math.max(size.x, size.y, size.z);\\n                        const fov = camera.fov * (Math.PI / 180);\\n                        let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));\\n                        cameraZ *= 1.5; // 增加一些距离\\n                        \\n                        camera.position.set(center.x, center.y + apartmentConfig.camera.height, center.z + cameraZ);\\n                        orbitControls.target.copy(center);\\n                        \\n                        // 隐藏加载界面\\n                        loadingOverlay.style.display = 'none';\\n                    },\\n                    function(progress) {\\n                        // 加载进度\\n                        console.log('Loading progress:', progress);\\n                    },\\n                    function(error) {\\n                        // 加载错误\\n                        console.error('Error loading model:', error);\\n                        loadingOverlay.innerHTML = '<div style=\\\"color: red;\\\">模型加载失败</div>';\\n                    }\\n                );\\n            }, undefined, function(error) {\\n                console.error('Error loading materials:', error);\\n                loadingOverlay.innerHTML = '<div style=\\\"color: red;\\\">材质加载失败</div>';\\n            });\\n        }\\n        \\n        function setupEventListeners() {\\n            // 控制模式切换\\n            document.getElementById('toggleControlModeBtn').addEventListener('click', toggleControlMode);\\n            \\n            // 视角按钮\\n            document.getElementById('viewTopBtn').addEventListener('click', () => setView('top'));\\n            document.getElementById('viewFrontBtn').addEventListener('click', () => setView('front'));\\n            document.getElementById('viewSideBtn').addEventListener('click', () => setView('side'));\\n            document.getElementById('resetViewBtn').addEventListener('click', resetView);\\n            \\n            // 线框模式\\n            document.getElementById('toggleWireframeBtn').addEventListener('click', toggleWireframe);\\n            \\n            // 截图\\n            document.getElementById('screenshotBtn').addEventListener('click', takeScreenshot);\\n            \\n            // 质量控制\\n            document.getElementById('qualitySelector').addEventListener('change', changeQuality);\\n            \\n            // FPS模式相关\\n            document.getElementById('enterFPSBtn').addEventListener('click', enterFPSMode);\\n            \\n            // 键盘事件\\n            document.addEventListener('keydown', onKeyDown);\\n            \\n            // 窗口大小调整\\n            window.addEventListener('resize', onWindowResize);\\n        }\\n        \\n        function toggleControlMode() {\\n            if (currentControlMode === 'orbit') {\\n                // 切换到FPS模式\\n                document.getElementById('pointerLockPrompt').classList.remove('hidden');\\n            } else {\\n                // 切换到轨道模式\\n                exitFPSMode();\\n            }\\n        }\\n        \\n        function enterFPSMode() {\\n            pointerLockControls.lock();\\n            currentControlMode = 'fps';\\n            orbitControls.enabled = false;\\n            pointerLockControls.enabled = true;\\n            keyboardControls.enable(); // 启用键盘控制\\n            document.getElementById('pointerLockPrompt').classList.add('hidden');\\n            document.getElementById('escExitPrompt').classList.remove('hidden');\\n            document.getElementById('controlModeText').textContent = '切换到鼠标模式';\\n        }\\n        \\n        function exitFPSMode() {\\n            pointerLockControls.unlock();\\n            currentControlMode = 'orbit';\\n            orbitControls.enabled = true;\\n            pointerLockControls.enabled = false;\\n            keyboardControls.disable(); // 禁用键盘控制\\n            document.getElementById('escExitPrompt').classList.add('hidden');\\n            document.getElementById('controlModeText').textContent = '切换到FPS模式';\\n        }\\n        \\n        function setView(viewType) {\\n            if (!model) return;\\n            \\n            const box = new THREE.Box3().setFromObject(model);\\n            const center = box.getCenter(new THREE.Vector3());\\n            const size = box.getSize(new THREE.Vector3());\\n            const maxDim = Math.max(size.x, size.y, size.z);\\n            \\n            switch(viewType) {\\n                case 'top':\\n                    camera.position.set(center.x, center.y + maxDim, center.z);\\n                    break;\\n                case 'front':\\n                    camera.position.set(center.x, center.y, center.z + maxDim);\\n                    break;\\n                case 'side':\\n                    camera.position.set(center.x + maxDim, center.y, center.z);\\n                    break;\\n            }\\n            \\n            orbitControls.target.copy(center);\\n            orbitControls.update();\\n        }\\n        \\n        function resetView() {\\n            if (!model) return;\\n            \\n            const box = new THREE.Box3().setFromObject(model);\\n            const center = box.getCenter(new THREE.Vector3());\\n            const size = box.getSize(new THREE.Vector3());\\n            const maxDim = Math.max(size.x, size.y, size.z);\\n            \\n            camera.position.set(center.x, center.y + apartmentConfig.camera.height, center.z + maxDim * 1.5);\\n            orbitControls.target.copy(center);\\n            orbitControls.update();\\n        }\\n        \\n        function toggleWireframe() {\\n            if (!model) return;\\n            \\n            isWireframe = !isWireframe;\\n            model.traverse(function(child) {\\n                if (child.isMesh) {\\n                    child.material.wireframe = isWireframe;\\n                }\\n            });\\n        }\\n        \\n        function takeScreenshot() {\\n            const link = document.createElement('a');\\n            link.download = `${apartmentConfig.name}_screenshot.png`;\\n            link.href = renderer.domElement.toDataURL();\\n            link.click();\\n        }\\n        \\n        function changeQuality(event) {\\n            const quality = event.target.value;\\n            let pixelRatio;\\n            \\n            switch(quality) {\\n                case 'low':\\n                    pixelRatio = 0.5;\\n                    break;\\n                case 'medium':\\n                    pixelRatio = 1;\\n                    break;\\n                case 'high':\\n                    pixelRatio = Math.min(window.devicePixelRatio, 2);\\n                    break;\\n            }\\n            \\n            renderer.setPixelRatio(pixelRatio);\\n        }\\n        \\n        function onKeyDown(event) {\\n            // 只处理ESC键，其他键让键盘控制器处理\\n            if (event.code === 'Escape' && currentControlMode === 'fps') {\\n                exitFPSMode();\\n                event.preventDefault();\\n                event.stopPropagation();\\n            }\\n        }\\n        \\n        function onWindowResize() {\\n            camera.aspect = (window.innerWidth - 280) / window.innerHeight;\\n            camera.updateProjectionMatrix();\\n            renderer.setSize(window.innerWidth - 280, window.innerHeight);\\n        }\\n        \\n        function animate() {\\n            animationId = requestAnimationFrame(animate);\\n            \\n            if (orbitControls.enabled) {\\n                orbitControls.update();\\n            }\\n            \\n            // 更新键盘控制\\n            if (keyboardControls && currentControlMode === 'fps') {\\n                keyboardControls.update();\\n            }\\n            \\n            renderer.render(scene, camera);\\n        }\\n        \\n        // 初始化\\n        init();\\n    </script>\\n</body>\\n</html>\\n      \");\n                        }\n                    }[\"Apartment3DViewer.useEffect.timer.create3DViewerHTML\"];\n                    // 创建iframe并设置内容\n                    const iframe = iframeRef.current;\n                    if (iframe) {\n                        var _iframe_contentWindow;\n                        const doc = iframe.contentDocument || ((_iframe_contentWindow = iframe.contentWindow) === null || _iframe_contentWindow === void 0 ? void 0 : _iframe_contentWindow.document);\n                        if (doc) {\n                            doc.open();\n                            doc.write(create3DViewerHTML());\n                            doc.close();\n                            setIsLoading(false);\n                        }\n                    }\n                }\n            }[\"Apartment3DViewer.useEffect.timer\"], 100) // 100ms延迟\n            ;\n            return ({\n                \"Apartment3DViewer.useEffect\": ()=>{\n                    clearTimeout(timer);\n                }\n            })[\"Apartment3DViewer.useEffect\"];\n        }\n    }[\"Apartment3DViewer.useEffect\"], [\n        apartment,\n        iframeKey\n    ]) // 添加iframeKey作为依赖\n    ;\n    // 组件卸载时重置iframe key来强制重新创建\n    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)({\n        \"Apartment3DViewer.useEffect\": ()=>{\n            return ({\n                \"Apartment3DViewer.useEffect\": ()=>{\n                    setIframeKey({\n                        \"Apartment3DViewer.useEffect\": (prev)=>prev + 1\n                    }[\"Apartment3DViewer.useEffect\"]);\n                }\n            })[\"Apartment3DViewer.useEffect\"];\n        }\n    }[\"Apartment3DViewer.useEffect\"], []);\n    // 监听iframe消息\n    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)({\n        \"Apartment3DViewer.useEffect\": ()=>{\n            const handleMessage = {\n                \"Apartment3DViewer.useEffect.handleMessage\": (event)=>{\n                    if (event.data === 'close' && onClose) {\n                        onClose();\n                    }\n                }\n            }[\"Apartment3DViewer.useEffect.handleMessage\"];\n            window.addEventListener('message', handleMessage);\n            return ({\n                \"Apartment3DViewer.useEffect\": ()=>window.removeEventListener('message', handleMessage)\n            })[\"Apartment3DViewer.useEffect\"];\n        }\n    }[\"Apartment3DViewer.useEffect\"], [\n        onClose\n    ]);\n    if (error) {\n        return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n            className: \"flex items-center justify-center h-full\",\n            children: /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n                className: \"text-center p-8\",\n                children: [\n                    /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"p\", {\n                        className: \"text-gray-500 mb-4\",\n                        children: error\n                    }, void 0, false, {\n                        fileName: \"/Users/jason/Project/My_Apartment_Web/components/apartment-3d-viewer.tsx\",\n                        lineNumber: 891,\n                        columnNumber: 11\n                    }, this),\n                    /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"p\", {\n                        className: \"text-sm text-gray-400\",\n                        children: \"该公寓模型正在准备中，敬请期待\"\n                    }, void 0, false, {\n                        fileName: \"/Users/jason/Project/My_Apartment_Web/components/apartment-3d-viewer.tsx\",\n                        lineNumber: 892,\n                        columnNumber: 11\n                    }, this)\n                ]\n            }, void 0, true, {\n                fileName: \"/Users/jason/Project/My_Apartment_Web/components/apartment-3d-viewer.tsx\",\n                lineNumber: 890,\n                columnNumber: 9\n            }, this)\n        }, void 0, false, {\n            fileName: \"/Users/jason/Project/My_Apartment_Web/components/apartment-3d-viewer.tsx\",\n            lineNumber: 889,\n            columnNumber: 7\n        }, this);\n    }\n    return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n        className: \"w-full h-full relative\",\n        children: [\n            isLoading && /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n                className: \"absolute inset-0 flex items-center justify-center bg-white z-10\",\n                children: /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n                    className: \"text-center\",\n                    children: [\n                        /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n                            className: \"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"\n                        }, void 0, false, {\n                            fileName: \"/Users/jason/Project/My_Apartment_Web/components/apartment-3d-viewer.tsx\",\n                            lineNumber: 903,\n                            columnNumber: 13\n                        }, this),\n                        /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"p\", {\n                            className: \"text-gray-500\",\n                            children: \"正在初始化3D查看器...\"\n                        }, void 0, false, {\n                            fileName: \"/Users/jason/Project/My_Apartment_Web/components/apartment-3d-viewer.tsx\",\n                            lineNumber: 904,\n                            columnNumber: 13\n                        }, this)\n                    ]\n                }, void 0, true, {\n                    fileName: \"/Users/jason/Project/My_Apartment_Web/components/apartment-3d-viewer.tsx\",\n                    lineNumber: 902,\n                    columnNumber: 11\n                }, this)\n            }, void 0, false, {\n                fileName: \"/Users/jason/Project/My_Apartment_Web/components/apartment-3d-viewer.tsx\",\n                lineNumber: 901,\n                columnNumber: 9\n            }, this),\n            /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"iframe\", {\n                ref: iframeRef,\n                className: \"w-full h-full border-0\",\n                title: \"\".concat(apartment.title, \" 3D查看器\"),\n                sandbox: \"allow-scripts allow-same-origin allow-downloads allow-pointer-lock\"\n            }, iframeKey, false, {\n                fileName: \"/Users/jason/Project/My_Apartment_Web/components/apartment-3d-viewer.tsx\",\n                lineNumber: 908,\n                columnNumber: 7\n            }, this)\n        ]\n    }, void 0, true, {\n        fileName: \"/Users/jason/Project/My_Apartment_Web/components/apartment-3d-viewer.tsx\",\n        lineNumber: 899,\n        columnNumber: 5\n    }, this);\n}\n_s(Apartment3DViewer, \"v9vXjC02A8v/NliTWBIniYKROxk=\");\n_c = Apartment3DViewer;\nvar _c;\n$RefreshReg$(_c, \"Apartment3DViewer\");\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL2NvbXBvbmVudHMvYXBhcnRtZW50LTNkLXZpZXdlci50c3giLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBRW1EO0FBUTVDLFNBQVNHLGtCQUFrQixLQUE4QztRQUE5QyxFQUFFQyxTQUFTLEVBQUVDLE9BQU8sRUFBMEIsR0FBOUM7O0lBQ2hDLE1BQU1DLFlBQVlMLDZDQUFNQSxDQUFvQjtJQUM1QyxNQUFNLENBQUNNLFdBQVdDLGFBQWEsR0FBR04sK0NBQVFBLENBQUM7SUFDM0MsTUFBTSxDQUFDTyxPQUFPQyxTQUFTLEdBQUdSLCtDQUFRQSxDQUFnQjtJQUNsRCxNQUFNLENBQUNTLFdBQVdDLGFBQWEsR0FBR1YsK0NBQVFBLENBQUMsR0FBRyxxQkFBcUI7O0lBRW5FRixnREFBU0E7dUNBQUM7WUFDUixJQUFJLENBQUNJLFVBQVVTLFFBQVEsRUFBRTtnQkFDdkJILFNBQVM7Z0JBQ1RGLGFBQWE7Z0JBQ2I7WUFDRjtZQUVBLE9BQU87WUFDUEUsU0FBUztZQUNURixhQUFhO1lBRWIsdUJBQXVCO1lBQ3ZCLE1BQU1NLFFBQVFDO3FEQUFXO29CQUN2QixpQkFBaUI7b0JBQ2pCLE1BQU1DO2dGQUFxQjs0QkFDekIsT0FBTyxzS0F5TnVDWixPQW5OekNBLFVBQVVhLEtBQUssRUFBQyw0dktBb05pRGIsT0FEeEJBLFVBQVVhLEtBQUssRUFBQyx1RkE2Q3pCYixPQTVDaUNBLFVBQVVjLFdBQVcsRUFBQyxvNkRBdUZsRUMsT0EzQ1dmLFVBQVVnQixNQUFNLENBQUNDLE1BQU0sQ0FBQ0MsTUFBTSxFQUFDLDIwREE0Qy9DbEIsT0FES2UsS0FBS0ksU0FBUyxDQUFDbkIsVUFBVWdCLE1BQU0sR0FBRSxrQ0FDbEIsT0FBcEJoQixVQUFVb0IsU0FBUyxFQUFDO3dCQThmM0M7O29CQUVBLGdCQUFnQjtvQkFDaEIsTUFBTUMsU0FBU25CLFVBQVVvQixPQUFPO29CQUNoQyxJQUFJRCxRQUFROzRCQUM0QkE7d0JBQXRDLE1BQU1FLE1BQU1GLE9BQU9HLGVBQWUsTUFBSUgsd0JBQUFBLE9BQU9JLGFBQWEsY0FBcEJKLDRDQUFBQSxzQkFBc0JLLFFBQVE7d0JBQ3BFLElBQUlILEtBQUs7NEJBQ1BBLElBQUlJLElBQUk7NEJBQ1JKLElBQUlLLEtBQUssQ0FBQ2hCOzRCQUNWVyxJQUFJTSxLQUFLOzRCQUNUekIsYUFBYTt3QkFDZjtvQkFDRjtnQkFDRjtvREFBRyxLQUFLLFVBQVU7O1lBRWxCOytDQUFPO29CQUNMMEIsYUFBYXBCO2dCQUNmOztRQUNGO3NDQUFHO1FBQUNWO1FBQVdPO0tBQVUsRUFBRSxrQkFBa0I7O0lBRTdDLDJCQUEyQjtJQUMzQlgsZ0RBQVNBO3VDQUFDO1lBQ1I7K0NBQU87b0JBQ0xZO3VEQUFhdUIsQ0FBQUEsT0FBUUEsT0FBTzs7Z0JBQzlCOztRQUNGO3NDQUFHLEVBQUU7SUFFTCxhQUFhO0lBQ2JuQyxnREFBU0E7dUNBQUM7WUFDUixNQUFNb0M7NkRBQWdCLENBQUNDO29CQUNyQixJQUFJQSxNQUFNQyxJQUFJLEtBQUssV0FBV2pDLFNBQVM7d0JBQ3JDQTtvQkFDRjtnQkFDRjs7WUFFQWtDLE9BQU9DLGdCQUFnQixDQUFDLFdBQVdKO1lBQ25DOytDQUFPLElBQU1HLE9BQU9FLG1CQUFtQixDQUFDLFdBQVdMOztRQUNyRDtzQ0FBRztRQUFDL0I7S0FBUTtJQUVaLElBQUlJLE9BQU87UUFDVCxxQkFDRSw4REFBQ2lDO1lBQUlDLFdBQVU7c0JBQ2IsNEVBQUNEO2dCQUFJQyxXQUFVOztrQ0FDYiw4REFBQ0M7d0JBQUVELFdBQVU7a0NBQXNCbEM7Ozs7OztrQ0FDbkMsOERBQUNtQzt3QkFBRUQsV0FBVTtrQ0FBd0I7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBSTdDO0lBRUEscUJBQ0UsOERBQUNEO1FBQUlDLFdBQVU7O1lBQ1pwQywyQkFDQyw4REFBQ21DO2dCQUFJQyxXQUFVOzBCQUNiLDRFQUFDRDtvQkFBSUMsV0FBVTs7c0NBQ2IsOERBQUNEOzRCQUFJQyxXQUFVOzs7Ozs7c0NBQ2YsOERBQUNDOzRCQUFFRCxXQUFVO3NDQUFnQjs7Ozs7Ozs7Ozs7Ozs7Ozs7MEJBSW5DLDhEQUFDbEI7Z0JBQ0NvQixLQUFLdkM7Z0JBRUxxQyxXQUFVO2dCQUNWMUIsT0FBTyxHQUFtQixPQUFoQmIsVUFBVWEsS0FBSyxFQUFDO2dCQUMxQjZCLFNBQVE7ZUFISG5DOzs7Ozs7Ozs7OztBQU9iO0dBMTRCZ0JSO0tBQUFBIiwic291cmNlcyI6WyIvVXNlcnMvamFzb24vUHJvamVjdC9NeV9BcGFydG1lbnRfV2ViL2NvbXBvbmVudHMvYXBhcnRtZW50LTNkLXZpZXdlci50c3giXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgY2xpZW50XCJcblxuaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7IEFwYXJ0bWVudERhdGEgfSBmcm9tIFwiQC91dGlscy9hcGFydG1lbnQtZGF0YVwiXG5cbmludGVyZmFjZSBBcGFydG1lbnQzRFZpZXdlclByb3BzIHtcbiAgYXBhcnRtZW50OiBBcGFydG1lbnREYXRhXG4gIG9uQ2xvc2U/OiAoKSA9PiB2b2lkXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBBcGFydG1lbnQzRFZpZXdlcih7IGFwYXJ0bWVudCwgb25DbG9zZSB9OiBBcGFydG1lbnQzRFZpZXdlclByb3BzKSB7XG4gIGNvbnN0IGlmcmFtZVJlZiA9IHVzZVJlZjxIVE1MSUZyYW1lRWxlbWVudD4obnVsbClcbiAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpXG4gIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbClcbiAgY29uc3QgW2lmcmFtZUtleSwgc2V0SWZyYW1lS2V5XSA9IHVzZVN0YXRlKDApIC8vIOa3u+WKoGtleeadpeW8uuWItumHjeaWsOWIm+W7umlmcmFtZVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKCFhcGFydG1lbnQuaGFzTW9kZWwpIHtcbiAgICAgIHNldEVycm9yKFwi6K+l5YWs5a+T5pqC5pegM0TmqKHlnotcIilcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSlcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIC8vIOmHjee9rueKtuaAgVxuICAgIHNldEVycm9yKG51bGwpXG4gICAgc2V0SXNMb2FkaW5nKHRydWUpXG4gICAgXG4gICAgLy8g5bu26L+f5LiA54K55pe26Ze056Gu5L+daWZyYW1l5a6M5YWo6YeN5paw5Yib5bu6XG4gICAgY29uc3QgdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIC8vIOWIm+W7ujNE5p+l55yL5Zmo55qESFRNTOWGheWuuVxuICAgICAgY29uc3QgY3JlYXRlM0RWaWV3ZXJIVE1MID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gYFxuPCFET0NUWVBFIGh0bWw+XG48aHRtbCBsYW5nPVwiemgtQ05cIj5cbjxoZWFkPlxuICAgIDxtZXRhIGNoYXJzZXQ9XCJVVEYtOFwiPlxuICAgIDxtZXRhIG5hbWU9XCJ2aWV3cG9ydFwiIGNvbnRlbnQ9XCJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wXCI+XG4gICAgPHRpdGxlPiR7YXBhcnRtZW50LnRpdGxlfSAtIDNE5p+l55yL5ZmoPC90aXRsZT5cbiAgICA8c3R5bGU+XG4gICAgICAgIGJvZHkge1xuICAgICAgICAgICAgbWFyZ2luOiAwO1xuICAgICAgICAgICAgcGFkZGluZzogMDtcbiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICdTZWdvZSBVSScsIFJvYm90bywgc2Fucy1zZXJpZjtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmNWY1ZjU7XG4gICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAudmlld2VyLWNvbnRhaW5lciB7XG4gICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgaGVpZ2h0OiAxMDB2aDtcbiAgICAgICAgICAgIHdpZHRoOiAxMDB2dztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLnNpZGViYXIge1xuICAgICAgICAgICAgd2lkdGg6IDI4MHB4O1xuICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7XG4gICAgICAgICAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAjZTVlNWU1O1xuICAgICAgICAgICAgcGFkZGluZzogMjBweDtcbiAgICAgICAgICAgIG92ZXJmbG93LXk6IGF1dG87XG4gICAgICAgICAgICBib3gtc2hhZG93OiAycHggMCAxMHB4IHJnYmEoMCwwLDAsMC4xKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLm1vZGVsLXZpZXcge1xuICAgICAgICAgICAgZmxleDogMTtcbiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmMGYwZjA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgICNtb2RlbENvbnRhaW5lciB7XG4gICAgICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgICAgIGhlaWdodDogMTAwJTtcbiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLnBhbmVsIHtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmOGY5ZmE7XG4gICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZTllY2VmO1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4O1xuICAgICAgICAgICAgcGFkZGluZzogMTZweDtcbiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDE2cHg7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC5wYW5lbCBoMyB7XG4gICAgICAgICAgICBtYXJnaW46IDAgMCAxMnB4IDA7XG4gICAgICAgICAgICBmb250LXNpemU6IDE0cHg7XG4gICAgICAgICAgICBmb250LXdlaWdodDogNjAwO1xuICAgICAgICAgICAgY29sb3I6ICMzMzM7XG4gICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAgICAgIGdhcDogOHB4O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAuYnRuIHtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICMwMDdiZmY7XG4gICAgICAgICAgICBjb2xvcjogd2hpdGU7XG4gICAgICAgICAgICBib3JkZXI6IG5vbmU7XG4gICAgICAgICAgICBwYWRkaW5nOiA4cHggMTZweDtcbiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDtcbiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTNweDtcbiAgICAgICAgICAgIG1hcmdpbjogNHB4O1xuICAgICAgICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAwLjJzO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAuYnRuOmhvdmVyIHtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICMwMDU2YjM7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC5idG4uc2Vjb25kYXJ5IHtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICM2Yzc1N2Q7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC5idG4uc2Vjb25kYXJ5OmhvdmVyIHtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICM1NDViNjI7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC5idG4uZnVsbC13aWR0aCB7XG4gICAgICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgICAgIG1hcmdpbjogNHB4IDA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC5jb250cm9scy1ncm91cCB7XG4gICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgZmxleC13cmFwOiB3cmFwO1xuICAgICAgICAgICAgZ2FwOiA0cHg7XG4gICAgICAgICAgICBtYXJnaW4tdG9wOiA4cHg7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC5jb250cm9scy1ncm91cCAuYnRuIHtcbiAgICAgICAgICAgIGZsZXg6IDE7XG4gICAgICAgICAgICBtaW4td2lkdGg6IDgwcHg7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNlbGVjdCB7XG4gICAgICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgICAgIHBhZGRpbmc6IDhweDtcbiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7XG4gICAgICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgICAgICBmb250LXNpemU6IDEzcHg7XG4gICAgICAgICAgICBtYXJnaW4tdG9wOiA4cHg7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC52aWV3LWluZm8ge1xuICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgICAgdG9wOiAyMHB4O1xuICAgICAgICAgICAgcmlnaHQ6IDIwcHg7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuNyk7XG4gICAgICAgICAgICBjb2xvcjogd2hpdGU7XG4gICAgICAgICAgICBwYWRkaW5nOiA4cHggMTJweDtcbiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDtcbiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDtcbiAgICAgICAgICAgIHotaW5kZXg6IDEwMDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLmVzYy1wcm9tcHQge1xuICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgICAgdG9wOiAyMHB4O1xuICAgICAgICAgICAgbGVmdDogMjBweDtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDAsMCwwLjgpO1xuICAgICAgICAgICAgY29sb3I6IHdoaXRlO1xuICAgICAgICAgICAgcGFkZGluZzogOHB4IDEycHg7XG4gICAgICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7XG4gICAgICAgICAgICBmb250LXNpemU6IDEycHg7XG4gICAgICAgICAgICB6LWluZGV4OiAxMDA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC5lc2MtcHJvbXB0LmhpZGRlbiB7XG4gICAgICAgICAgICBkaXNwbGF5OiBub25lO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAjbG9hZGluZ092ZXJsYXkge1xuICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgICAgdG9wOiAwO1xuICAgICAgICAgICAgbGVmdDogMDtcbiAgICAgICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwwLjkpO1xuICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgICAgICB6LWluZGV4OiAxMDAwO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAuc3Bpbm5lciB7XG4gICAgICAgICAgICB3aWR0aDogNDBweDtcbiAgICAgICAgICAgIGhlaWdodDogNDBweDtcbiAgICAgICAgICAgIGJvcmRlcjogNHB4IHNvbGlkICNmM2YzZjM7XG4gICAgICAgICAgICBib3JkZXItdG9wOiA0cHggc29saWQgIzAwN2JmZjtcbiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTtcbiAgICAgICAgICAgIGFuaW1hdGlvbjogc3BpbiAxcyBsaW5lYXIgaW5maW5pdGU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIEBrZXlmcmFtZXMgc3BpbiB7XG4gICAgICAgICAgICAwJSB7IHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOyB9XG4gICAgICAgICAgICAxMDAlIHsgdHJhbnNmb3JtOiByb3RhdGUoMzYwZGVnKTsgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAubG9hZGluZy10ZXh0IHtcbiAgICAgICAgICAgIG1hcmdpbi10b3A6IDE2cHg7XG4gICAgICAgICAgICBmb250LXNpemU6IDE0cHg7XG4gICAgICAgICAgICBjb2xvcjogIzY2NjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLmNlbnRlci1zY3JlZW4ge1xuICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgICAgdG9wOiA1MCU7XG4gICAgICAgICAgICBsZWZ0OiA1MCU7XG4gICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTtcbiAgICAgICAgICAgIHotaW5kZXg6IDIwMDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLmNlbnRlci1zY3JlZW4uaGlkZGVuIHtcbiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC5wcm9tcHQtY29udGVudCB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTtcbiAgICAgICAgICAgIHBhZGRpbmc6IDIwcHg7XG4gICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7XG4gICAgICAgICAgICBib3gtc2hhZG93OiAwIDRweCAyMHB4IHJnYmEoMCwwLDAsMC4zKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLmNsb3NlLWJ0biB7XG4gICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgICAgICB0b3A6IDEwcHg7XG4gICAgICAgICAgICByaWdodDogMTBweDtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC41KTtcbiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTtcbiAgICAgICAgICAgIGJvcmRlcjogbm9uZTtcbiAgICAgICAgICAgIHdpZHRoOiAzMHB4O1xuICAgICAgICAgICAgaGVpZ2h0OiAzMHB4O1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlO1xuICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgICAgICAgei1pbmRleDogMTAwMTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLmNsb3NlLWJ0bjpob3ZlciB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuNyk7XG4gICAgICAgIH1cbiAgICA8L3N0eWxlPlxuPC9oZWFkPlxuPGJvZHk+XG4gICAgPGRpdiBjbGFzcz1cInZpZXdlci1jb250YWluZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInNpZGViYXJcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwYW5lbFwiPlxuICAgICAgICAgICAgICAgIDxoMz7wn4+gIOWFrOWvk+S/oeaBrzwvaDM+XG4gICAgICAgICAgICAgICAgPGg0IHN0eWxlPVwibWFyZ2luOiAwOyBjb2xvcjogIzMzMztcIj4ke2FwYXJ0bWVudC50aXRsZX08L2g0PlxuICAgICAgICAgICAgICAgIDxwIHN0eWxlPVwiZm9udC1zaXplOiAxMnB4OyBjb2xvcjogIzY2NjsgbWFyZ2luOiA4cHggMCAwIDA7XCI+JHthcGFydG1lbnQuZGVzY3JpcHRpb259PC9wPlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwYW5lbFwiPlxuICAgICAgICAgICAgICAgIDxoMz7wn46uIOinhuinkuaOp+WItjwvaDM+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRyb2xzLWdyb3VwXCI+XG4gICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9XCJ0b2dnbGVDb250cm9sTW9kZUJ0blwiIGNsYXNzPVwiYnRuIGZ1bGwtd2lkdGhcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPVwiY29udHJvbE1vZGVUZXh0XCI+5YiH5o2i5YiwRlBT5qih5byPPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udHJvbHMtZ3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cInZpZXdUb3BCdG5cIiBjbGFzcz1cImJ0biBzZWNvbmRhcnlcIj7pobbop4blm748L2J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cInZpZXdGcm9udEJ0blwiIGNsYXNzPVwiYnRuIHNlY29uZGFyeVwiPuato+inhuWbvjwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPVwidmlld1NpZGVCdG5cIiBjbGFzcz1cImJ0biBzZWNvbmRhcnlcIj7kvqfop4blm748L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udHJvbHMtZ3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cInJlc2V0Vmlld0J0blwiIGNsYXNzPVwiYnRuIGZ1bGwtd2lkdGhcIj7ph43nva7op4blm748L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udHJvbHMtZ3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cInRvZ2dsZVdpcmVmcmFtZUJ0blwiIGNsYXNzPVwiYnRuIHNlY29uZGFyeSBmdWxsLXdpZHRoXCI+5YiH5o2i57q/5qGG5qih5byPPC9idXR0b24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInBhbmVsXCI+XG4gICAgICAgICAgICAgICAgPGgzPuKame+4jyDotKjph4/mjqfliLY8L2gzPlxuICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJxdWFsaXR5U2VsZWN0b3JcIj7muLLmn5PotKjph486PC9sYWJlbD5cbiAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPVwicXVhbGl0eVNlbGVjdG9yXCI+XG4gICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJsb3dcIj7kvY4gKOabtOa1geeVhSk8L29wdGlvbj5cbiAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIm1lZGl1bVwiIHNlbGVjdGVkPuS4rSAo5bmz6KGhKTwvb3B0aW9uPlxuICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiaGlnaFwiPumrmCAo5pu05riF5pmwKTwvb3B0aW9uPlxuICAgICAgICAgICAgICAgIDwvc2VsZWN0PlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwYW5lbFwiPlxuICAgICAgICAgICAgICAgIDxoMz7wn5O3IOaIquWbvjwvaDM+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cInNjcmVlbnNob3RCdG5cIiBjbGFzcz1cImJ0biBmdWxsLXdpZHRoXCI+5L+d5a2Y5oiq5Zu+PC9idXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGVsLXZpZXdcIj5cbiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJjbG9zZS1idG5cIiBvbmNsaWNrPVwid2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSgnY2xvc2UnLCAnKicpXCIgdGl0bGU9XCLlhbPpl61cIj7DlzwvYnV0dG9uPlxuICAgICAgICAgICAgPGRpdiBpZD1cIm1vZGVsQ29udGFpbmVyXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInZpZXctaW5mb1wiPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPVwicm90YXRpb25JbmZvXCI+6KeG6KeSOiAwwrA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD1cInpvb21JbmZvXCI+6auY5bqmOiAke2FwYXJ0bWVudC5jb25maWcuY2FtZXJhLmhlaWdodH1tPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBpZD1cImVzY0V4aXRQcm9tcHRcIiBjbGFzcz1cImVzYy1wcm9tcHQgaGlkZGVuXCI+XG4gICAgICAgICAgICAgICAgICAgIOaMiUVTQ+mAgOWHukZQU+aooeW8j1xuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgaWQ9XCJsb2FkaW5nT3ZlcmxheVwiPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3Bpbm5lclwiPjwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibG9hZGluZy10ZXh0XCI+5q2j5Zyo5Yqg6L295qih5Z6LLi4uPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBpZD1cInBvaW50ZXJMb2NrUHJvbXB0XCIgY2xhc3M9XCJjZW50ZXItc2NyZWVuIGhpZGRlblwiPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicHJvbXB0LWNvbnRlbnRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9XCJlbnRlckZQU0J0blwiIGNsYXNzPVwiYnRuIGZ1bGwtd2lkdGhcIiBzdHlsZT1cImZvbnQtc2l6ZToxLjFyZW07cGFkZGluZzoxZW0gMmVtO1wiPueCueWHu+S7peWQr+eUqEZQU+aOp+WItjwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cblxuICAgIDwhLS0gVGhyZWUuanMg5bqTIC0tPlxuICAgIDxzY3JpcHQgc3JjPVwiaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvdGhyZWUuanMvcjEyOC90aHJlZS5taW4uanNcIj48L3NjcmlwdD5cbiAgICA8c2NyaXB0IHNyYz1cImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vdGhyZWVAMC4xMjguMC9leGFtcGxlcy9qcy9jb250cm9scy9PcmJpdENvbnRyb2xzLm1pbi5qc1wiPjwvc2NyaXB0PlxuICAgIDxzY3JpcHQgc3JjPVwiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS90aHJlZUAwLjEyOC4wL2V4YW1wbGVzL2pzL2NvbnRyb2xzL1BvaW50ZXJMb2NrQ29udHJvbHMubWluLmpzXCI+PC9zY3JpcHQ+XG4gICAgPHNjcmlwdCBzcmM9XCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL3RocmVlQDAuMTI4LjAvZXhhbXBsZXMvanMvbG9hZGVycy9PQkpMb2FkZXIubWluLmpzXCI+PC9zY3JpcHQ+XG4gICAgPHNjcmlwdCBzcmM9XCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL3RocmVlQDAuMTI4LjAvZXhhbXBsZXMvanMvbG9hZGVycy9NVExMb2FkZXIubWluLmpzXCI+PC9zY3JpcHQ+XG4gICAgXG4gICAgPHNjcmlwdD5cbiAgICAgICAgLy8g5by65Yi26YeN572u5omA5pyJ5YWo5bGA5Y+Y6YePXG4gICAgICAgIGlmICh3aW5kb3cuc2NlbmUpIHtcbiAgICAgICAgICAgIHdpbmRvdy5zY2VuZS5jbGVhcigpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3aW5kb3cucmVuZGVyZXIpIHtcbiAgICAgICAgICAgIHdpbmRvdy5yZW5kZXJlci5kaXNwb3NlKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIDNE5p+l55yL5Zmo5Yid5aeL5YyW6ISa5pysXG4gICAgICAgIGxldCBzY2VuZSwgY2FtZXJhLCByZW5kZXJlciwgY29udHJvbHMsIG1vZGVsO1xuICAgICAgICBsZXQgb3JiaXRDb250cm9scywgcG9pbnRlckxvY2tDb250cm9scztcbiAgICAgICAgbGV0IGlzV2lyZWZyYW1lID0gZmFsc2U7XG4gICAgICAgIGxldCBjdXJyZW50Q29udHJvbE1vZGUgPSAnb3JiaXQnOyAvLyAnb3JiaXQnIG9yICdmcHMnXG4gICAgICAgIGxldCBhbmltYXRpb25JZCA9IG51bGw7IC8vIOeUqOS6jua4heeQhuWKqOeUu+W+queOr1xuICAgICAgICBsZXQga2V5Ym9hcmRDb250cm9scyA9IG51bGw7IC8vIOmUruebmOaOp+WItuWZqFxuICAgICAgICBcbiAgICAgICAgLy8g5YWs5a+T6YWN572uXG4gICAgICAgIGNvbnN0IGFwYXJ0bWVudENvbmZpZyA9ICR7SlNPTi5zdHJpbmdpZnkoYXBhcnRtZW50LmNvbmZpZyl9O1xuICAgICAgICBjb25zdCBtb2RlbFBhdGggPSBcIiR7YXBhcnRtZW50Lm1vZGVsUGF0aH1cIjtcbiAgICAgICAgXG4gICAgICAgIC8vIOmUruebmOaOp+WItuexuyAtIOWujOaVtOeahFdBU0Tnp7vliqjpgLvovpFcbiAgICAgICAgY2xhc3MgS2V5Ym9hcmRDb250cm9scyB7XG4gICAgICAgICAgICBjb25zdHJ1Y3RvcihjYW1lcmEsIHNjZW5lLCBkb21FbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW1lcmEgPSBjYW1lcmE7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9tRWxlbWVudCA9IGRvbUVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8g5o6n5Yi254q25oCBXG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5pc01vdmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIOenu+WKqOWPguaVsFxuICAgICAgICAgICAgICAgIHRoaXMubW92ZW1lbnRTcGVlZCA9IDAuMDU7XG4gICAgICAgICAgICAgICAgdGhpcy5maXhlZEhlaWdodCA9IHRoaXMuY2FtZXJhLnBvc2l0aW9uLnk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8g5oyJ6ZSu54q25oCBXG4gICAgICAgICAgICAgICAgdGhpcy5rZXlzID0ge1xuICAgICAgICAgICAgICAgICAgICA4NzogZmFsc2UsIC8vIFdcbiAgICAgICAgICAgICAgICAgICAgODM6IGZhbHNlLCAvLyBTXG4gICAgICAgICAgICAgICAgICAgIDY1OiBmYWxzZSwgLy8gQVxuICAgICAgICAgICAgICAgICAgICA2ODogZmFsc2UsIC8vIERcbiAgICAgICAgICAgICAgICAgICAgMzg6IGZhbHNlLCAvLyDkuIrnrq3lpLRcbiAgICAgICAgICAgICAgICAgICAgNDA6IGZhbHNlLCAvLyDkuIvnrq3lpLRcbiAgICAgICAgICAgICAgICAgICAgMzc6IGZhbHNlLCAvLyDlt6bnrq3lpLRcbiAgICAgICAgICAgICAgICAgICAgMzk6IGZhbHNlICAvLyDlj7Pnrq3lpLRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIOe7keWumuS6i+S7tuWkhOeQhuWHveaVsFxuICAgICAgICAgICAgICAgIHRoaXMuX29uS2V5RG93biA9IHRoaXMuX29uS2V5RG93bi5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX29uS2V5VXAgPSB0aGlzLl9vbktleVVwLmJpbmQodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGVuYWJsZSgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbmFibGVkKSByZXR1cm47XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5fb25LZXlEb3duLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLl9vbktleVVwLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+mUruebmOaOp+WItuW3suWQr+eUqCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBkaXNhYmxlKCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5lbmFibGVkKSByZXR1cm47XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX29uS2V5RG93biwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5fb25LZXlVcCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIOmHjee9ruaMiemUrueKtuaAgVxuICAgICAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiB0aGlzLmtleXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5rZXlzW2tleV0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5pc01vdmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfplK7nm5jmjqfliLblt7LnpoHnlKgnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgX29uS2V5RG93bihldmVudCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5lbmFibGVkKSByZXR1cm47XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY29uc3Qga2V5Q29kZSA9IGV2ZW50LmtleUNvZGU7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8g5qOA5p+l56e75Yqo6ZSuXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ3cnIHx8IGV2ZW50LmtleSA9PT0gJ1cnIHx8IGtleUNvZGUgPT09IDg3IHx8IGtleUNvZGUgPT09IDM4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMua2V5c1s4N10gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5ID09PSAncycgfHwgZXZlbnQua2V5ID09PSAnUycgfHwga2V5Q29kZSA9PT0gODMgfHwga2V5Q29kZSA9PT0gNDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5rZXlzWzgzXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09ICdhJyB8fCBldmVudC5rZXkgPT09ICdBJyB8fCBrZXlDb2RlID09PSA2NSB8fCBrZXlDb2RlID09PSAzNykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmtleXNbNjVdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gJ2QnIHx8IGV2ZW50LmtleSA9PT0gJ0QnIHx8IGtleUNvZGUgPT09IDY4IHx8IGtleUNvZGUgPT09IDM5KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMua2V5c1s2OF0gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyDpmLvmraLpu5jorqTooYzkuLpcbiAgICAgICAgICAgICAgICBpZiAoWzMyLCAzNywgMzgsIDM5LCA0MCwgODcsIDgzLCA2NSwgNjhdLmluY2x1ZGVzKGtleUNvZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBfb25LZXlVcChldmVudCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5lbmFibGVkKSByZXR1cm47XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY29uc3Qga2V5Q29kZSA9IGV2ZW50LmtleUNvZGU7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8g5qOA5p+l56e75Yqo6ZSuXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ3cnIHx8IGV2ZW50LmtleSA9PT0gJ1cnIHx8IGtleUNvZGUgPT09IDg3IHx8IGtleUNvZGUgPT09IDM4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMua2V5c1s4N10gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gJ3MnIHx8IGV2ZW50LmtleSA9PT0gJ1MnIHx8IGtleUNvZGUgPT09IDgzIHx8IGtleUNvZGUgPT09IDQwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMua2V5c1s4M10gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gJ2EnIHx8IGV2ZW50LmtleSA9PT0gJ0EnIHx8IGtleUNvZGUgPT09IDY1IHx8IGtleUNvZGUgPT09IDM3KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMua2V5c1s2NV0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gJ2QnIHx8IGV2ZW50LmtleSA9PT0gJ0QnIHx8IGtleUNvZGUgPT09IDY4IHx8IGtleUNvZGUgPT09IDM5KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMua2V5c1s2OF0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHVwZGF0ZSgpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIOajgOafpeaMiemUrueKtuaAgVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtb3ZpbmdGb3J3YXJkID0gdGhpcy5rZXlzWzg3XTsgLy8gV1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtb3ZpbmdCYWNrd2FyZCA9IHRoaXMua2V5c1s4M107IC8vIFNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW92aW5nTGVmdCA9IHRoaXMua2V5c1s2NV07IC8vIEFcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW92aW5nUmlnaHQgPSB0aGlzLmtleXNbNjhdOyAvLyBEXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzmsqHmnInmjInplK7mjInkuIvvvIznm7TmjqXov5Tlm55cbiAgICAgICAgICAgICAgICAgICAgaWYgKCEobW92aW5nRm9yd2FyZCB8fCBtb3ZpbmdCYWNrd2FyZCB8fCBtb3ZpbmdMZWZ0IHx8IG1vdmluZ1JpZ2h0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNNb3ZpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzTW92aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIOiOt+WPluebuOacuueahOacneWQkVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbWVyYS5nZXRXb3JsZERpcmVjdGlvbihkaXJlY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb24ubm9ybWFsaXplKCk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyDojrflj5blj7PlkJHph49cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmlnaHQgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xuICAgICAgICAgICAgICAgICAgICByaWdodC5jcm9zc1ZlY3RvcnMoZGlyZWN0aW9uLCBuZXcgVEhSRUUuVmVjdG9yMygwLCAxLCAwKSkubm9ybWFsaXplKCk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyDorqHnrpfnp7vliqjlkJHph49cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW92ZVZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDApO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1vdmluZ0ZvcndhcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVWZWN0b3IuYWRkKGRpcmVjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1vdmluZ0JhY2t3YXJkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb3ZlVmVjdG9yLnN1YihkaXJlY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChtb3ZpbmdSaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbW92ZVZlY3Rvci5hZGQocmlnaHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChtb3ZpbmdMZWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb3ZlVmVjdG9yLnN1YihyaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIOW9kuS4gOWMluenu+WKqOWQkemHj1xuICAgICAgICAgICAgICAgICAgICBtb3ZlVmVjdG9yLm5vcm1hbGl6ZSgpO1xuICAgICAgICAgICAgICAgICAgICBtb3ZlVmVjdG9yLm11bHRpcGx5U2NhbGFyKHRoaXMubW92ZW1lbnRTcGVlZCk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyDlj6rlnKh4euW5s+mdouenu+WKqFxuICAgICAgICAgICAgICAgICAgICBtb3ZlVmVjdG9yLnkgPSAwO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8g5pu05paw55u45py65L2N572uXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhLnBvc2l0aW9uLmFkZChtb3ZlVmVjdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW1lcmEucG9zaXRpb24ueSA9IHRoaXMuZml4ZWRIZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNNb3ZpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNNb3ZpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign6ZSu55uY5o6n5Yi25pu05paw5pe25Ye66ZSZOicsIGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHNldEZpeGVkSGVpZ2h0KGhlaWdodCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZml4ZWRIZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHNldE1vdmVtZW50U3BlZWQoc3BlZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1vdmVtZW50U3BlZWQgPSBzcGVlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8g5riF55CG5LmL5YmN55qE6LWE5rqQXG4gICAgICAgIGZ1bmN0aW9uIGNsZWFudXAoKSB7XG4gICAgICAgICAgICBpZiAoYW5pbWF0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZShhbmltYXRpb25JZCk7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uSWQgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoa2V5Ym9hcmRDb250cm9scykge1xuICAgICAgICAgICAgICAgIGtleWJvYXJkQ29udHJvbHMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgICAgIGtleWJvYXJkQ29udHJvbHMgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAocmVuZGVyZXIpIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5kaXNwb3NlKCk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuZm9yY2VDb250ZXh0TG9zcygpO1xuICAgICAgICAgICAgICAgIGlmIChyZW5kZXJlci5kb21FbGVtZW50ICYmIHJlbmRlcmVyLmRvbUVsZW1lbnQucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5kb21FbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoc2NlbmUpIHtcbiAgICAgICAgICAgICAgICBzY2VuZS5jbGVhcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyDmuIXnkIbkuovku7bnm5HlkKzlmahcbiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvbldpbmRvd1Jlc2l6ZSk7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25LZXlEb3duKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8g5Yid5aeL5YyWM0TlnLrmma9cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8g5YWI5riF55CG5LmL5YmN55qE6LWE5rqQXG4gICAgICAgICAgICAgICAgY2xlYW51cCgpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIOWIm+W7uuWcuuaZr1xuICAgICAgICAgICAgICAgIHNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG4gICAgICAgICAgICAgICAgc2NlbmUuYmFja2dyb3VuZCA9IG5ldyBUSFJFRS5Db2xvcigweGYwZjBmMCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8g5Yib5bu655u45py6XG4gICAgICAgICAgICAgICAgY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKDc1LCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgMC4xLCAxMDAwKTtcbiAgICAgICAgICAgICAgICBjYW1lcmEucG9zaXRpb24uc2V0KGFwYXJ0bWVudENvbmZpZy5jYW1lcmEuaW5pdF9wb2ludFswXSwgYXBhcnRtZW50Q29uZmlnLmNhbWVyYS5oZWlnaHQsIGFwYXJ0bWVudENvbmZpZy5jYW1lcmEuaW5pdF9wb2ludFsxXSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8g5Yib5bu65riy5p+T5ZmoXG4gICAgICAgICAgICAgICAgcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7IGFudGlhbGlhczogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoIC0gMjgwLCB3aW5kb3cuaW5uZXJIZWlnaHQpO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnNoYWRvd01hcC5lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5zaGFkb3dNYXAudHlwZSA9IFRIUkVFLlBDRlNvZnRTaGFkb3dNYXA7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGVsQ29udGFpbmVyJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgY2FudmFzID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpO1xuICAgICAgICAgICAgICAgIGlmIChjYW52YXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnJlbW92ZUNoaWxkKGNhbnZhcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChyZW5kZXJlci5kb21FbGVtZW50KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyDliJvlu7rmjqfliLblmahcbiAgICAgICAgICAgICAgICBzZXR1cENvbnRyb2xzKCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8g5re75Yqg5YWJ5rqQXG4gICAgICAgICAgICAgICAgc2V0dXBMaWdodGluZygpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIOWKoOi9veaooeWei1xuICAgICAgICAgICAgICAgIGxvYWRNb2RlbCgpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIOiuvue9ruS6i+S7tuebkeWQrFxuICAgICAgICAgICAgICAgIHNldHVwRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyDlvIDlp4vmuLLmn5Plvqrnjq9cbiAgICAgICAgICAgICAgICBhbmltYXRlKCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIneWni+WMljNE5Zy65pmv5aSx6LSlOicsIGVycm9yKTtcbiAgICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nT3ZlcmxheScpO1xuICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkge1xuICAgICAgICAgICAgICAgICAgICBsb2FkaW5nT3ZlcmxheS5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT1cImNvbG9yOiByZWQ7XCI+M0TlnLrmma/liJ3lp4vljJblpLHotKU8L2Rpdj4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZnVuY3Rpb24gc2V0dXBDb250cm9scygpIHtcbiAgICAgICAgICAgIC8vIOi9qOmBk+aOp+WItuWZqFxuICAgICAgICAgICAgb3JiaXRDb250cm9scyA9IG5ldyBUSFJFRS5PcmJpdENvbnRyb2xzKGNhbWVyYSwgcmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgICAgICAgICBvcmJpdENvbnRyb2xzLmVuYWJsZURhbXBpbmcgPSB0cnVlO1xuICAgICAgICAgICAgb3JiaXRDb250cm9scy5kYW1waW5nRmFjdG9yID0gMC4wNTtcbiAgICAgICAgICAgIG9yYml0Q29udHJvbHMudGFyZ2V0LnNldCgwLCAwLCAwKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gRlBT5o6n5Yi25ZmoXG4gICAgICAgICAgICBwb2ludGVyTG9ja0NvbnRyb2xzID0gbmV3IFRIUkVFLlBvaW50ZXJMb2NrQ29udHJvbHMoY2FtZXJhLCByZW5kZXJlci5kb21FbGVtZW50KTtcbiAgICAgICAgICAgIHNjZW5lLmFkZChwb2ludGVyTG9ja0NvbnRyb2xzLmdldE9iamVjdCgpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8g6ZSu55uY5o6n5Yi25ZmoXG4gICAgICAgICAgICBrZXlib2FyZENvbnRyb2xzID0gbmV3IEtleWJvYXJkQ29udHJvbHMoY2FtZXJhLCBzY2VuZSwgcmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgICAgICAgICBrZXlib2FyZENvbnRyb2xzLnNldEZpeGVkSGVpZ2h0KGFwYXJ0bWVudENvbmZpZy5jYW1lcmEuaGVpZ2h0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8g6buY6K6k5L2/55So6L2o6YGT5o6n5Yi25ZmoXG4gICAgICAgICAgICBvcmJpdENvbnRyb2xzLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgcG9pbnRlckxvY2tDb250cm9scy5lbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICBrZXlib2FyZENvbnRyb2xzLmRpc2FibGUoKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZnVuY3Rpb24gc2V0dXBMaWdodGluZygpIHtcbiAgICAgICAgICAgIC8vIOeOr+Wig+WFiVxuICAgICAgICAgICAgY29uc3QgYW1iaWVudExpZ2h0ID0gbmV3IFRIUkVFLkFtYmllbnRMaWdodCgweDQwNDA0MCwgMC42KTtcbiAgICAgICAgICAgIHNjZW5lLmFkZChhbWJpZW50TGlnaHQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyDmlrnlkJHlhYlcbiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGlvbmFsTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZiwgMC44KTtcbiAgICAgICAgICAgIGRpcmVjdGlvbmFsTGlnaHQucG9zaXRpb24uc2V0KDEwLCAxMCwgNSk7XG4gICAgICAgICAgICBkaXJlY3Rpb25hbExpZ2h0LmNhc3RTaGFkb3cgPSB0cnVlO1xuICAgICAgICAgICAgc2NlbmUuYWRkKGRpcmVjdGlvbmFsTGlnaHQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyDngrnlhYnmupBcbiAgICAgICAgICAgIGNvbnN0IHBvaW50TGlnaHQgPSBuZXcgVEhSRUUuUG9pbnRMaWdodCgweGZmZmZmZiwgMC41KTtcbiAgICAgICAgICAgIHBvaW50TGlnaHQucG9zaXRpb24uc2V0KDAsIDUsIDApO1xuICAgICAgICAgICAgc2NlbmUuYWRkKHBvaW50TGlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmdW5jdGlvbiBsb2FkTW9kZWwoKSB7XG4gICAgICAgICAgICBjb25zdCBsb2FkaW5nT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nT3ZlcmxheScpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBNVEzliqDovb3lmahcbiAgICAgICAgICAgIGNvbnN0IG10bExvYWRlciA9IG5ldyBUSFJFRS5NVExMb2FkZXIoKTtcbiAgICAgICAgICAgIG10bExvYWRlci5zZXRQYXRoKG1vZGVsUGF0aCArICcvJyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG10bExvYWRlci5sb2FkKCd0ZXh0dXJlZF9vdXRwdXQubXRsJywgZnVuY3Rpb24obWF0ZXJpYWxzKSB7XG4gICAgICAgICAgICAgICAgbWF0ZXJpYWxzLnByZWxvYWQoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBPQkrliqDovb3lmahcbiAgICAgICAgICAgICAgICBjb25zdCBvYmpMb2FkZXIgPSBuZXcgVEhSRUUuT0JKTG9hZGVyKCk7XG4gICAgICAgICAgICAgICAgb2JqTG9hZGVyLnNldE1hdGVyaWFscyhtYXRlcmlhbHMpO1xuICAgICAgICAgICAgICAgIG9iakxvYWRlci5zZXRQYXRoKG1vZGVsUGF0aCArICcvJyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgb2JqTG9hZGVyLmxvYWQoJ3RleHR1cmVkX291dHB1dC5vYmonLCBcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDmqKHlnovliqDovb3miJDlip9cbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsID0gb2JqZWN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmUuYWRkKG1vZGVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g6K6h566X5qih5Z6L6L6555WM55uSXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBib3ggPSBuZXcgVEhSRUUuQm94MygpLnNldEZyb21PYmplY3QobW9kZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VudGVyID0gYm94LmdldENlbnRlcihuZXcgVEhSRUUuVmVjdG9yMygpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpemUgPSBib3guZ2V0U2l6ZShuZXcgVEhSRUUuVmVjdG9yMygpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g6LCD5pW055u45py65L2N572uXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXhEaW0gPSBNYXRoLm1heChzaXplLngsIHNpemUueSwgc2l6ZS56KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvdiA9IGNhbWVyYS5mb3YgKiAoTWF0aC5QSSAvIDE4MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2FtZXJhWiA9IE1hdGguYWJzKG1heERpbSAvIDIgLyBNYXRoLnRhbihmb3YgLyAyKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmFaICo9IDEuNTsgLy8g5aKe5Yqg5LiA5Lqb6Led56a7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5wb3NpdGlvbi5zZXQoY2VudGVyLngsIGNlbnRlci55ICsgYXBhcnRtZW50Q29uZmlnLmNhbWVyYS5oZWlnaHQsIGNlbnRlci56ICsgY2FtZXJhWik7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcmJpdENvbnRyb2xzLnRhcmdldC5jb3B5KGNlbnRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOmakOiXj+WKoOi9veeVjOmdolxuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ092ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24ocHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWKoOi9vei/m+W6plxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0xvYWRpbmcgcHJvZ3Jlc3M6JywgcHJvZ3Jlc3MpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Yqg6L296ZSZ6K+vXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIG1vZGVsOicsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdPdmVybGF5LmlubmVySFRNTCA9ICc8ZGl2IHN0eWxlPVwiY29sb3I6IHJlZDtcIj7mqKHlnovliqDovb3lpLHotKU8L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0sIHVuZGVmaW5lZCwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIG1hdGVyaWFsczonLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgbG9hZGluZ092ZXJsYXkuaW5uZXJIVE1MID0gJzxkaXYgc3R5bGU9XCJjb2xvcjogcmVkO1wiPuadkOi0qOWKoOi9veWksei0pTwvZGl2Pic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZnVuY3Rpb24gc2V0dXBFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgICAgIC8vIOaOp+WItuaooeW8j+WIh+aNolxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZUNvbnRyb2xNb2RlQnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVDb250cm9sTW9kZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIOinhuinkuaMiemSrlxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZXdUb3BCdG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNldFZpZXcoJ3RvcCcpKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWV3RnJvbnRCdG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNldFZpZXcoJ2Zyb250JykpO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZXdTaWRlQnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBzZXRWaWV3KCdzaWRlJykpO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc2V0Vmlld0J0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVzZXRWaWV3KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8g57q/5qGG5qih5byPXG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlV2lyZWZyYW1lQnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVXaXJlZnJhbWUpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyDmiKrlm75cbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JlZW5zaG90QnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0YWtlU2NyZWVuc2hvdCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIOi0qOmHj+aOp+WItlxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1YWxpdHlTZWxlY3RvcicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGNoYW5nZVF1YWxpdHkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBGUFPmqKHlvI/nm7jlhbNcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbnRlckZQU0J0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZW50ZXJGUFNNb2RlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8g6ZSu55uY5LqL5Lu2XG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25LZXlEb3duKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8g56qX5Y+j5aSn5bCP6LCD5pW0XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgb25XaW5kb3dSZXNpemUpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmdW5jdGlvbiB0b2dnbGVDb250cm9sTW9kZSgpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50Q29udHJvbE1vZGUgPT09ICdvcmJpdCcpIHtcbiAgICAgICAgICAgICAgICAvLyDliIfmjaLliLBGUFPmqKHlvI9cbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9pbnRlckxvY2tQcm9tcHQnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8g5YiH5o2i5Yiw6L2o6YGT5qih5byPXG4gICAgICAgICAgICAgICAgZXhpdEZQU01vZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZnVuY3Rpb24gZW50ZXJGUFNNb2RlKCkge1xuICAgICAgICAgICAgcG9pbnRlckxvY2tDb250cm9scy5sb2NrKCk7XG4gICAgICAgICAgICBjdXJyZW50Q29udHJvbE1vZGUgPSAnZnBzJztcbiAgICAgICAgICAgIG9yYml0Q29udHJvbHMuZW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgcG9pbnRlckxvY2tDb250cm9scy5lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGtleWJvYXJkQ29udHJvbHMuZW5hYmxlKCk7IC8vIOWQr+eUqOmUruebmOaOp+WItlxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvaW50ZXJMb2NrUHJvbXB0JykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXNjRXhpdFByb21wdCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRyb2xNb2RlVGV4dCcpLnRleHRDb250ZW50ID0gJ+WIh+aNouWIsOm8oOagh+aooeW8jyc7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZ1bmN0aW9uIGV4aXRGUFNNb2RlKCkge1xuICAgICAgICAgICAgcG9pbnRlckxvY2tDb250cm9scy51bmxvY2soKTtcbiAgICAgICAgICAgIGN1cnJlbnRDb250cm9sTW9kZSA9ICdvcmJpdCc7XG4gICAgICAgICAgICBvcmJpdENvbnRyb2xzLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgcG9pbnRlckxvY2tDb250cm9scy5lbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICBrZXlib2FyZENvbnRyb2xzLmRpc2FibGUoKTsgLy8g56aB55So6ZSu55uY5o6n5Yi2XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXNjRXhpdFByb21wdCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRyb2xNb2RlVGV4dCcpLnRleHRDb250ZW50ID0gJ+WIh+aNouWIsEZQU+aooeW8jyc7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZ1bmN0aW9uIHNldFZpZXcodmlld1R5cGUpIHtcbiAgICAgICAgICAgIGlmICghbW9kZWwpIHJldHVybjtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgYm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KG1vZGVsKTtcbiAgICAgICAgICAgIGNvbnN0IGNlbnRlciA9IGJveC5nZXRDZW50ZXIobmV3IFRIUkVFLlZlY3RvcjMoKSk7XG4gICAgICAgICAgICBjb25zdCBzaXplID0gYm94LmdldFNpemUobmV3IFRIUkVFLlZlY3RvcjMoKSk7XG4gICAgICAgICAgICBjb25zdCBtYXhEaW0gPSBNYXRoLm1heChzaXplLngsIHNpemUueSwgc2l6ZS56KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgc3dpdGNoKHZpZXdUeXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLnBvc2l0aW9uLnNldChjZW50ZXIueCwgY2VudGVyLnkgKyBtYXhEaW0sIGNlbnRlci56KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZnJvbnQnOlxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEucG9zaXRpb24uc2V0KGNlbnRlci54LCBjZW50ZXIueSwgY2VudGVyLnogKyBtYXhEaW0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdzaWRlJzpcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLnBvc2l0aW9uLnNldChjZW50ZXIueCArIG1heERpbSwgY2VudGVyLnksIGNlbnRlci56KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG9yYml0Q29udHJvbHMudGFyZ2V0LmNvcHkoY2VudGVyKTtcbiAgICAgICAgICAgIG9yYml0Q29udHJvbHMudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZ1bmN0aW9uIHJlc2V0VmlldygpIHtcbiAgICAgICAgICAgIGlmICghbW9kZWwpIHJldHVybjtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgYm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KG1vZGVsKTtcbiAgICAgICAgICAgIGNvbnN0IGNlbnRlciA9IGJveC5nZXRDZW50ZXIobmV3IFRIUkVFLlZlY3RvcjMoKSk7XG4gICAgICAgICAgICBjb25zdCBzaXplID0gYm94LmdldFNpemUobmV3IFRIUkVFLlZlY3RvcjMoKSk7XG4gICAgICAgICAgICBjb25zdCBtYXhEaW0gPSBNYXRoLm1heChzaXplLngsIHNpemUueSwgc2l6ZS56KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY2FtZXJhLnBvc2l0aW9uLnNldChjZW50ZXIueCwgY2VudGVyLnkgKyBhcGFydG1lbnRDb25maWcuY2FtZXJhLmhlaWdodCwgY2VudGVyLnogKyBtYXhEaW0gKiAxLjUpO1xuICAgICAgICAgICAgb3JiaXRDb250cm9scy50YXJnZXQuY29weShjZW50ZXIpO1xuICAgICAgICAgICAgb3JiaXRDb250cm9scy51cGRhdGUoKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlV2lyZWZyYW1lKCkge1xuICAgICAgICAgICAgaWYgKCFtb2RlbCkgcmV0dXJuO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpc1dpcmVmcmFtZSA9ICFpc1dpcmVmcmFtZTtcbiAgICAgICAgICAgIG1vZGVsLnRyYXZlcnNlKGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkLmlzTWVzaCkge1xuICAgICAgICAgICAgICAgICAgICBjaGlsZC5tYXRlcmlhbC53aXJlZnJhbWUgPSBpc1dpcmVmcmFtZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZnVuY3Rpb24gdGFrZVNjcmVlbnNob3QoKSB7XG4gICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgICAgICAgbGluay5kb3dubG9hZCA9IFxcYFxcJHthcGFydG1lbnRDb25maWcubmFtZX1fc2NyZWVuc2hvdC5wbmdcXGA7XG4gICAgICAgICAgICBsaW5rLmhyZWYgPSByZW5kZXJlci5kb21FbGVtZW50LnRvRGF0YVVSTCgpO1xuICAgICAgICAgICAgbGluay5jbGljaygpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmdW5jdGlvbiBjaGFuZ2VRdWFsaXR5KGV2ZW50KSB7XG4gICAgICAgICAgICBjb25zdCBxdWFsaXR5ID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgbGV0IHBpeGVsUmF0aW87XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHN3aXRjaChxdWFsaXR5KSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnbG93JzpcbiAgICAgICAgICAgICAgICAgICAgcGl4ZWxSYXRpbyA9IDAuNTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnbWVkaXVtJzpcbiAgICAgICAgICAgICAgICAgICAgcGl4ZWxSYXRpbyA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2hpZ2gnOlxuICAgICAgICAgICAgICAgICAgICBwaXhlbFJhdGlvID0gTWF0aC5taW4od2luZG93LmRldmljZVBpeGVsUmF0aW8sIDIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyhwaXhlbFJhdGlvKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZnVuY3Rpb24gb25LZXlEb3duKGV2ZW50KSB7XG4gICAgICAgICAgICAvLyDlj6rlpITnkIZFU0PplK7vvIzlhbbku5bplK7orqnplK7nm5jmjqfliLblmajlpITnkIZcbiAgICAgICAgICAgIGlmIChldmVudC5jb2RlID09PSAnRXNjYXBlJyAmJiBjdXJyZW50Q29udHJvbE1vZGUgPT09ICdmcHMnKSB7XG4gICAgICAgICAgICAgICAgZXhpdEZQU01vZGUoKTtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmdW5jdGlvbiBvbldpbmRvd1Jlc2l6ZSgpIHtcbiAgICAgICAgICAgIGNhbWVyYS5hc3BlY3QgPSAod2luZG93LmlubmVyV2lkdGggLSAyODApIC8gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICAgICAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLnNldFNpemUod2luZG93LmlubmVyV2lkdGggLSAyODAsIHdpbmRvdy5pbm5lckhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7XG4gICAgICAgICAgICBhbmltYXRpb25JZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKG9yYml0Q29udHJvbHMuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIG9yYml0Q29udHJvbHMudXBkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIOabtOaWsOmUruebmOaOp+WItlxuICAgICAgICAgICAgaWYgKGtleWJvYXJkQ29udHJvbHMgJiYgY3VycmVudENvbnRyb2xNb2RlID09PSAnZnBzJykge1xuICAgICAgICAgICAgICAgIGtleWJvYXJkQ29udHJvbHMudXBkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgY2FtZXJhKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8g5Yid5aeL5YyWXG4gICAgICAgIGluaXQoKTtcbiAgICA8L3NjcmlwdD5cbjwvYm9keT5cbjwvaHRtbD5cbiAgICAgIGBcbiAgICAgIH1cblxuICAgICAgLy8g5Yib5bu6aWZyYW1l5bm26K6+572u5YaF5a65XG4gICAgICBjb25zdCBpZnJhbWUgPSBpZnJhbWVSZWYuY3VycmVudFxuICAgICAgaWYgKGlmcmFtZSkge1xuICAgICAgICBjb25zdCBkb2MgPSBpZnJhbWUuY29udGVudERvY3VtZW50IHx8IGlmcmFtZS5jb250ZW50V2luZG93Py5kb2N1bWVudFxuICAgICAgICBpZiAoZG9jKSB7XG4gICAgICAgICAgZG9jLm9wZW4oKVxuICAgICAgICAgIGRvYy53cml0ZShjcmVhdGUzRFZpZXdlckhUTUwoKSlcbiAgICAgICAgICBkb2MuY2xvc2UoKVxuICAgICAgICAgIHNldElzTG9hZGluZyhmYWxzZSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIDEwMCkgLy8gMTAwbXPlu7bov59cblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZXIpXG4gICAgfVxuICB9LCBbYXBhcnRtZW50LCBpZnJhbWVLZXldKSAvLyDmt7vliqBpZnJhbWVLZXnkvZzkuLrkvp3otZZcblxuICAvLyDnu4Tku7bljbjovb3ml7bph43nva5pZnJhbWUga2V55p2l5by65Yi26YeN5paw5Yib5bu6XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHNldElmcmFtZUtleShwcmV2ID0+IHByZXYgKyAxKVxuICAgIH1cbiAgfSwgW10pXG5cbiAgLy8g55uR5ZCsaWZyYW1l5raI5oGvXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaGFuZGxlTWVzc2FnZSA9IChldmVudDogTWVzc2FnZUV2ZW50KSA9PiB7XG4gICAgICBpZiAoZXZlbnQuZGF0YSA9PT0gJ2Nsb3NlJyAmJiBvbkNsb3NlKSB7XG4gICAgICAgIG9uQ2xvc2UoKVxuICAgICAgfVxuICAgIH1cblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgaGFuZGxlTWVzc2FnZSlcbiAgICByZXR1cm4gKCkgPT4gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBoYW5kbGVNZXNzYWdlKVxuICB9LCBbb25DbG9zZV0pXG5cbiAgaWYgKGVycm9yKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgaC1mdWxsXCI+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1jZW50ZXIgcC04XCI+XG4gICAgICAgICAgPHAgY2xhc3NOYW1lPVwidGV4dC1ncmF5LTUwMCBtYi00XCI+e2Vycm9yfTwvcD5cbiAgICAgICAgICA8cCBjbGFzc05hbWU9XCJ0ZXh0LXNtIHRleHQtZ3JheS00MDBcIj7or6Xlhazlr5PmqKHlnovmraPlnKjlh4blpIfkuK3vvIzmlazor7fmnJ/lvoU8L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKVxuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT1cInctZnVsbCBoLWZ1bGwgcmVsYXRpdmVcIj5cbiAgICAgIHtpc0xvYWRpbmcgJiYgKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImFic29sdXRlIGluc2V0LTAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgYmctd2hpdGUgei0xMFwiPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1jZW50ZXJcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYW5pbWF0ZS1zcGluIHJvdW5kZWQtZnVsbCBoLTEyIHctMTIgYm9yZGVyLWItMiBib3JkZXItYmx1ZS01MDAgbXgtYXV0byBtYi00XCI+PC9kaXY+XG4gICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJ0ZXh0LWdyYXktNTAwXCI+5q2j5Zyo5Yid5aeL5YyWM0Tmn6XnnIvlmaguLi48L3A+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKX1cbiAgICAgIDxpZnJhbWVcbiAgICAgICAgcmVmPXtpZnJhbWVSZWZ9XG4gICAgICAgIGtleT17aWZyYW1lS2V5fVxuICAgICAgICBjbGFzc05hbWU9XCJ3LWZ1bGwgaC1mdWxsIGJvcmRlci0wXCJcbiAgICAgICAgdGl0bGU9e2Ake2FwYXJ0bWVudC50aXRsZX0gM0Tmn6XnnIvlmahgfVxuICAgICAgICBzYW5kYm94PVwiYWxsb3ctc2NyaXB0cyBhbGxvdy1zYW1lLW9yaWdpbiBhbGxvdy1kb3dubG9hZHMgYWxsb3ctcG9pbnRlci1sb2NrXCJcbiAgICAgIC8+XG4gICAgPC9kaXY+XG4gIClcbn0gIl0sIm5hbWVzIjpbInVzZUVmZmVjdCIsInVzZVJlZiIsInVzZVN0YXRlIiwiQXBhcnRtZW50M0RWaWV3ZXIiLCJhcGFydG1lbnQiLCJvbkNsb3NlIiwiaWZyYW1lUmVmIiwiaXNMb2FkaW5nIiwic2V0SXNMb2FkaW5nIiwiZXJyb3IiLCJzZXRFcnJvciIsImlmcmFtZUtleSIsInNldElmcmFtZUtleSIsImhhc01vZGVsIiwidGltZXIiLCJzZXRUaW1lb3V0IiwiY3JlYXRlM0RWaWV3ZXJIVE1MIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsIkpTT04iLCJjb25maWciLCJjYW1lcmEiLCJoZWlnaHQiLCJzdHJpbmdpZnkiLCJtb2RlbFBhdGgiLCJpZnJhbWUiLCJjdXJyZW50IiwiZG9jIiwiY29udGVudERvY3VtZW50IiwiY29udGVudFdpbmRvdyIsImRvY3VtZW50Iiwib3BlbiIsIndyaXRlIiwiY2xvc2UiLCJjbGVhclRpbWVvdXQiLCJwcmV2IiwiaGFuZGxlTWVzc2FnZSIsImV2ZW50IiwiZGF0YSIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZGl2IiwiY2xhc3NOYW1lIiwicCIsInJlZiIsInNhbmRib3giXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(app-pages-browser)/./components/apartment-3d-viewer.tsx\n"));

/***/ })

});